(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[604],{4009:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/instruments/[figi]",function(){return r(8239)}])},8239:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return xe}});var n=r(4051),a=r.n(n),c=r(5893),s=r(1163),o=r(7294),i=r(5384),u=r.n(i),l=r(751),f=r.n(l),p=r(7982),d=function(e){return e.nano?e.units+e.nano/1e9:e.units},v=r(5708),h=r.n(v),b=r(2929),x=r.n(b),m=r(2176),k=r(9475),g=r.n(k);function w(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}var y=function(e){return[d(e.price),e.quantity]},j=function(e,t){return e[t].map(y).sort((function(e,t){return e[0]-t[0]}))};function S(e){var t,r,n,s=e.data,i=e.step,l=e.serverUri,f=e.figi,v=e.interval,b=e.isBackTest,m=(0,o.useState)(),k=m[0],y=m[1],S=(0,o.useState)([]),C=S[0],T=S[1],D=o.useCallback((t=a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,b?s[i]&&s[i][0]&&(0,p.zU)(l,f,s[i][0]):(0,p.nx)(l,f);case 4:(t=e.sent)?"undefined"!==typeof i||b?i&&(T(t),y(d(t.lastPrice))):t.length&&(r=d(t[0].lastPrices[0].price),y(r),T(t[1])):T();case 6:case"end":return e.stop()}}),e)})),function(){var e=this,r=arguments;return new Promise((function(n,a){var c=t.apply(e,r);function s(e){w(c,n,a,s,o,"next",e)}function o(e){w(c,n,a,s,o,"throw",e)}s(void 0)}))}),[f,v,l,b,i]);o.useEffect((function(){x()(u())}),[]),o.useEffect((function(){D();var e=!b&&setInterval((function(){D()}),1500);return function(){e&&clearInterval(e)}}),[v,b,D]),C&&C.bids&&C.asks?(r=j(C,"bids")||[],n=j(C,"asks")||[]):(r=[],n=[]);var P={chart:{type:"area",animation:!1},navigator:{enabled:!1},scrollbar:{enabled:!1},rangeSelector:!1,xAxis:{minPadding:0,maxPadding:0,type:"linear",step:1,labels:{rotation:-45,autoRotation:!1},plotLines:k?[{color:"#888",value:k,width:1,label:{text:k,rotation:90}}]:void 0},yAxis:[{lineWidth:1,gridLineWidth:1,title:null,tickWidth:1,tickLength:5,tickPosition:"inside",labels:{align:"left",x:8},resize:{enabled:!1}}],legend:{enabled:!1},plotOptions:{area:{fillOpacity:.2,lineWidth:1,step:"center"}},tooltip:{headerFormat:'<span style="font-size=10px;">Price: {point.key}</span><br/>',valueDecimals:0},series:[{name:"\u0421\u043f\u0440\u043e\u0441",data:r,color:"#03a7a8",animation:!1},{name:"\u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435",data:n,color:"#fc5857",animation:!1}]},I=(0,o.useState)(!0),_=I[0],B=I[1],O=(0,o.useCallback)((function(){return B(!_)}),[_,B]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"".concat(g().OrderBook," ").concat(_?"":g().OrderBook_hidden),children:(0,c.jsx)(h(),{highcharts:u(),constructorType:"stockChart",options:P})}),(0,c.jsx)("div",{className:g().OrderBookHide,onClick:O,children:_?"\u0421\u043a\u0440\u044b\u0442\u044c \u0441\u0442\u0430\u043a\u0430\u043d":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u0442\u0430\u043a\u0430\u043d"})]})}function C(e){var t=e.data,r=e.inProgress,n=e.setInprogress,a=e.options,s=e.step,i=e.isBackTest,l=e.serverUri,p=e.interval,d=e.figi,v=o.useRef(null);return o.useEffect((function(){f()(u()),x()(u())}),[]),t.length&&!r&&n?(0,c.jsx)(m.W2,{fluid:!0,children:(0,c.jsxs)(m.X2,{children:[(0,c.jsx)(m.JX,{className:"bg-light border w-auto ".concat(g().TerminalColChart),children:(0,c.jsx)(h(),{ref:v,highcharts:u(),constructorType:"stockChart",options:a})}),(0,c.jsx)(m.JX,{className:"bg-light border ".concat(g().TerminalColOrderBook),children:(0,c.jsx)(S,{data:t,step:s,serverUri:l,interval:p,figi:d,isBackTest:i})})]})}):""}var T={chart:{height:400,animation:!1},xAxis:{type:"datetime"},yAxis:[{labels:{align:"left"},height:"80%",resize:{enabled:!1}},{labels:{align:"left"},top:"80%",height:"20%",offset:0}],rangeSelector:!1,tooltip:{style:{width:"200px"},valueDecimals:4,shared:!0},scrollbar:{enabled:!1},navigator:{enabled:!1},plotOptions:{candlestick:{color:"red",upColor:"green",label:{borderRadius:10}},series:{pointInterval:6e4}},series:[{lastVisiblePrice:{enabled:!0,label:{enabled:!0}},type:"candlestick",data:[],id:"candles",tooltip:{valueDecimals:2},animation:!1},{type:"column",name:"\u041e\u0431\u044a\u0451\u043c",data:[],yAxis:1,tooltip:{valueDecimals:0},animation:!1},{type:"flags",useHTML:!0,onSeries:"candles",shape:"squarepin",fillColor:"#018000",color:"#018000",y:-100,width:12},{type:"flags",useHTML:!0,onSeries:"candles",shape:"squarepin",fillColor:"#FF2A06",color:"#FF2A06",y:50,width:12}],responsive:{rules:[{condition:{maxWidth:"100%"},chartOptions:{rangeSelector:!1}}]}};function D(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function P(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){D(c,n,a,s,o,"next",e)}function o(e){D(c,n,a,s,o,"throw",e)}s(void 0)}))}}var I={cache:"no-cache","Content-Type":"application/json"},_=function(){var e=P(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch(t+"/robots/getnames",I);case 4:r=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!r||!r.ok){e.next=14;break}return e.next=13,r.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=P(a().mark((function e(t,r,n,c,s,o,i,u){var l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch(t+"/robots/start/".concat(n,"?accountId=").concat(u,"&interval=").concat(s,"&backtest=").concat(Number(o),"\n            &adviser=").concat(Number(i),"&name=").concat(r,"&date=").concat(c.getTime()),I);case 4:l=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!l||!l.ok){e.next=14;break}return e.next=13,l.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r,n,a,c,s,o,i){return e.apply(this,arguments)}}(),O=function(){var e=P(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch(t+"/robots/backtest/step/".concat(r),I);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=14;break}return e.next=13,n.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),A=function(){var e=P(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch(t+"/robots/stop/?name=".concat(r),I);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=14;break}return e.next=13,n.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=P(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch(t+"/robots/status/?name=".concat(r),I);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=14;break}return e.next=13,n.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),U=r(9249),R=r.n(U);function N(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function z(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){N(c,n,a,s,o,"next",e)}function o(e){N(c,n,a,s,o,"throw",e)}s(void 0)}))}}function F(e){var t=e.interval,r=e.setStep,n=e.step,s=e.maxStep,i=e.setBacktestData,u=e.setBacktestVolume,l=e.data,f=e.volume,p=e.selectedRobot,d=e.serverUri,v=e.figi,h=e.selectedDate,b=e.setRobotPositions,x=(0,o.useState)(),k=x[0],g=x[1],w=(0,o.useState)(!1),y=w[0],j=w[1],S=(0,o.useState)(!1),C=S[0],T=S[1],D=(0,o.useCallback)(z(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),i([]),u([]),r(-1),e.next=6,B(d,p,v,h,t+1,1,1);case 6:case"end":return e.stop()}}),e)}))),[i,u,d,p,v,h,t,r]),P=(0,o.useCallback)(z(a().mark((function e(){var t,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k&&!C){e.next=2;break}return e.abrupt("return");case 2:return s<(t=n+1)&&T(!0),e.next=6,O(d,t);case 6:c=e.sent,b(c),i(l.map((function(e,r){return r>t?[e[0],void 0,void 0,void 0,void 0]:e}))),u(f.map((function(e,r){return r>t?[e[0],void 0]:e}))),r(t);case 11:case"end":return e.stop()}}),e)}))),[n,k,r,i,C,s,b,u,l,f,d]);(0,o.useEffect)((function(){k&&y&&P()}),[n,y,P,k]);var I=(0,o.useCallback)(z(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(d,p);case 2:r(),j(!1),g(!1),T(!1),i(),u(),b();case 9:case"end":return e.stop()}}),e)}))),[r,j,b,g,i,u,p,d]),_=(0,o.useCallback)((function(){return j(!1)}),[j]);return(0,o.useEffect)((function(){I()}),[t,h,I]),(0,c.jsxs)(m.hE,{className:R().BacktestButtons,children:[(0,c.jsx)(m.zx,{color:"primary",onClick:D,disabled:!p||k,children:"\u0421\u0442\u0430\u0440\u0442"}),(0,c.jsx)(m.zx,{color:"primary",disabled:!k||y||C,onClick:P,children:"\u0428\u0430\u0433"}),y?(0,c.jsx)(m.zx,{color:"primary",disabled:C,onClick:_,children:"\u0421\u0442\u043e\u043f"}):(0,c.jsx)(m.zx,{color:"primary",disabled:!k||C,onClick:function(){j(!0),T(!1)},children:"\u0410\u0432\u0442\u043e"}),(0,c.jsx)(m.zx,{color:"primary",disabled:!k,onClick:I||y,children:"\u0421\u0431\u0440\u043e\u0441"})]})}var L=r(858),M=r.n(L);function H(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function W(e){var t=e.setRobotName,r=e.serverUri,n=e.disabled,s=e.setSelectedRobots,i=(0,o.useState)([]),u=i[0],l=i[1],f=(0,o.useCallback)((function(e){s(e.target.value)}),[s]);return o.useEffect((function(){var e;(e=a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(r);case 2:(t=e.sent)&&t.length&&l(t);case 4:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){H(c,n,a,s,o,"next",e)}function o(e){H(c,n,a,s,o,"throw",e)}s(void 0)}))})()}),[t,r]),(0,c.jsx)(m.cw,{className:M().RobotsSelect,children:(0,c.jsxs)(m.II,{id:"select",name:"select",type:"select",disabled:n,onChange:f,children:[(0,c.jsx)("option",{value:"",children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u043e\u0431\u043e\u0442\u0430"}),u.map((function(e,t){return(0,c.jsx)("option",{value:e,children:e},t)}))]})})}function $(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function X(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){$(c,n,a,s,o,"next",e)}function o(e){$(c,n,a,s,o,"throw",e)}s(void 0)}))}}function q(e){e.interval;var t=e.selectedRobot,r=e.serverUri,n=e.figi,s=e.selectedDate,i=e.setIsRobotStarted,u=e.accountId,l=(0,o.useState)(),f=l[0],p=l[1],d=(0,o.useState)(!0),v=d[0],h=(d[1],(0,o.useCallback)(X(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),i(!0),e.next=4,B(r,t,n,s,1,0,v,u);case 4:case"end":return e.stop()}}),e)}))),[r,t,u,v,i,n,s])),b=(0,o.useCallback)((function(){}),[]),x=(0,o.useCallback)(X(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(r,t);case 2:p(!1),i(!1);case 4:case"end":return e.stop()}}),e)}))),[r,t,i]);return(0,c.jsxs)(m.hE,{className:R().BacktestButtons,children:[(0,c.jsx)(m.zx,{color:"primary",onClick:h,disabled:!t||f,children:"\u0421\u0442\u0430\u0440\u0442"}),(0,c.jsx)(m.zx,{color:"primary",disabled:!f,onClick:b,children:"\u041e\u043a"}),(0,c.jsx)(m.zx,{color:"primary",disabled:!f,onClick:x,children:"\u0421\u0442\u043e\u043f"})]})}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function Q(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){V(c,n,a,s,o,"next",e)}function o(e){V(c,n,a,s,o,"throw",e)}s(void 0)}))}}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){K(e,t,r[t])}))}return e}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,c=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);s=!0);}catch(i){o=!0,a=i}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}return c}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return J(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e){var t=e.instrument,r=e.figi,n=e.setInprogress,s=e.selectedDate,i=e.interval,l=e.setIsTradingDay,v=e.serverUri,h=e.inProgress,b=e.accountId,x=G(o.useState([]),2),m=x[0],k=x[1],g=G(o.useState([]),2),w=g[0],y=g[1],j=(0,o.useState)(),S=j[0],D=j[1],P=(0,o.useState)(!1),I=(P[0],P[1]);o.useEffect((function(){Q(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(v);case 2:e.sent;case 4:case"end":return e.stop()}}),e)})))()}),[v]);var _=o.useCallback(Q(a().mark((function e(){var t,n,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.wO)(v,r,i+1,s);case 2:return(t=e.sent)&&t.candles&&(n=[],c=[],t.candles.forEach((function(e){var t=new Date(e.time).getTime()-6e4*(new Date).getTimezoneOffset();n.push([t,d(e.open),d(e.high),d(e.low),d(e.close)]),c.push([t,e.volume])})),k(n),y(c)),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))),[r,i,s,k,y,v]),B=o.useCallback(Q(a().mark((function e(){var c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n&&r&&s){e.next=2;break}return e.abrupt("return");case 2:return n(!0),e.next=5,_();case 5:(c=e.sent)&&c.candles&&(c.candles.length||l(!1),n(!1));case 7:case"end":return e.stop()}}),e)}))),[t,i,r,n,s,l,_,k,y]);o.useEffect((function(){f()(u())}),[]),o.useEffect((function(){B();var e=setInterval((function(){_()}),5e3);return function(){clearTimeout(e)}}),[i,B,_]);var O=Y({},T,{series:[Y({},T.series[0],{data:m}),Y({},T.series[1],{data:w})]});return(0,c.jsxs)("div",{className:R().Backtest,children:[(0,c.jsx)(C,{data:m,dl:m.length,inProgress:h,setInprogress:n,options:O,serverUri:v,interval:i,figi:r,isBackTest:!1}),(0,c.jsx)(W,{serverUri:v,setSelectedRobots:D}),(0,c.jsx)(q,{interval:i,selectedRobot:S,serverUri:v,figi:r,selectedDate:s,setIsRobotStarted:I,accountId:b})]})}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function te(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function re(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){te(c,n,a,s,o,"next",e)}function o(e){te(c,n,a,s,o,"throw",e)}s(void 0)}))}}function ne(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ne(e,t,r[t])}))}return e}function ce(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,c=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);s=!0);}catch(i){o=!0,a=i}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}return c}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ee(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function se(e){var t=e.instrument,r=e.figi,n=e.setInprogress,s=e.selectedDate,i=e.interval,l=e.setIsTradingDay,v=e.serverUri,h=e.inProgress,b=ce(o.useState([]),2),x=b[0],m=b[1],k=ce(o.useState([]),2),g=k[0],w=k[1],y=ce(o.useState(),2),j=y[0],S=y[1],D=ce(o.useState(),2),P=D[0],I=D[1],_=(0,o.useState)(0),B=_[0],O=_[1],A=(0,o.useState)(),U=A[0],N=A[1],z=(0,o.useState)(),L=z[0],M=z[1],H=(0,o.useState)(),$=H[0],X=H[1];o.useEffect((function(){re(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(v);case 2:e.sent;case 4:case"end":return e.stop()}}),e)})))()}),[v]);var q=o.useCallback(re(a().mark((function e(){var c,o,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n&&r&&s){e.next=2;break}return e.abrupt("return");case 2:return n(!0),e.next=5,(0,p.wO)(v,r,i+1,s);case 5:(c=e.sent)&&c.candles&&(o=[],u=[],c.candles.forEach((function(e){var t=new Date(e.time).getTime()-6e4*(new Date).getTimezoneOffset();o.push([t,d(e.open),d(e.high),d(e.low),d(e.close)]),u.push([t,e.volume])})),m(o),w(u),O(o.length-1),c.candles.length||l(!1),n(!1));case 7:case"end":return e.stop()}}),e)}))),[t,r,i,n,v,s,l,O]);o.useEffect((function(){f()(u()),q()}),[q]);var J=ae({},T,{series:[ae({},T.series[0],{data:j||x}),ae({},T.series[1],{data:P||g})]}),V=$&&$.length?ae({},T.series[2],{data:$.filter((function(e){return 1===e.direction})).map((function(e){return{title:'<div class="'.concat(R().Arrow," ").concat(R().BuyArrow,'">B<br>U<br>Y</div>'),text:"\u0426\u0435\u043d\u0430: ".concat(d(e.price),"<br>\u041b\u043e\u0442\u044b: ").concat(e.lots),x:x[e.step][0]}}))}):void 0,Q=$&&$.length?ae({},T.series[3],{data:$.filter((function(e){return 2===e.direction})).map((function(e){return{title:'<div class="'.concat(R().Arrow," ").concat(R().SellArrow,'">S<br>E<br>L<br>L</div>'),text:"\u041f\u0440\u043e\u0444\u0438\u0442: ".concat(d(e.profit),"<br>\u041b\u043e\u0442\u044b: ").concat(e.lots),x:x[e.step][0]}}))}):void 0;return V&&V.data.length&&J.series.push(V),Q&&Q.data.length&&J.series.push(Q),(0,c.jsxs)("div",{className:R().Backtest,children:[(0,c.jsx)(C,{data:x,inProgress:h,setInprogress:n,options:J,serverUri:v,step:U,interval:i,figi:r,isBackTest:!0,robotPositions:$}),(0,c.jsx)(W,{serverUri:v,setSelectedRobots:M,disabled:"undefined"!==typeof U}),(0,c.jsx)(F,{interval:i,setStep:N,step:U,maxStep:B,setBacktestData:S,setBacktestVolume:I,data:x,volume:g,selectedRobot:L,serverUri:v,figi:r,selectedDate:s,setRobotPositions:X})]})}var oe=r(2854),ie=r(9198),ue=r.n(ie);r(5828);function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fe(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function pe(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var c=e.apply(t,r);function s(e){fe(c,n,a,s,o,"next",e)}function o(e){fe(c,n,a,s,o,"throw",e)}s(void 0)}))}}function de(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,c=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);s=!0);}catch(i){o=!0,a=i}finally{try{s||null==r.return||r.return()}finally{if(o)throw a}}return c}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return le(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ve=["1 \u043c\u0438\u043d","5 \u043c\u0438\u043d","15 \u043c\u0438\u043d","1 \u0447\u0430\u0441"],he=function(e){var t=e.setTickerInterval,r=e.interval,n=o.useCallback((function(e){t(e),(0,oe.gJ)("interval",e)}),[t]);return(0,c.jsx)(m.hE,{children:ve.map((function(e,t){return(0,c.jsx)(m.zx,{color:"primary",outline:!0,active:r===t,onClick:n.bind(undefined,t),children:e},t)}))})},be=function(e,t){return e.toDateString()===t.toDateString()};function xe(e){var t=e.setTitle,r=e.serverUri,n=e.accountId,i=(0,s.useRouter)(),u=i.push,l=i.isReady,f=i.query.figi,d=(0,oe.cG)(),v=de(o.useState(d.interval||1),2),h=v[0],b=v[1],x=de(o.useState(!0),2),m=x[0],k=x[1],g=de(o.useState(),2),w=g[0],y=g[1],j=de(o.useState(),2),S=j[0],C=j[1],T=de(o.useState(d.selectedDate&&new Date(d.selectedDate)||new Date),2),D=T[0],P=T[1],I=(0,o.useState)(!be(new Date,D)),_=I[0],B=I[1],O=o.useCallback(function(){var e=pe(a().mark((function e(t,n){var c,s,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n||D,s=!0,o=new Date,!(be(c,o)||c>=o)){e.next=8;break}return e.next=6,(0,p.C$)(r,t,c);case 6:(i=e.sent)&&i.exchanges&&(s=Boolean(i.exchanges[0].days[0].isTradingDay));case 8:y(s);case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[D,r]),A=o.useCallback(function(){var e=pe(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(t),(0,oe.gJ)("selectedDate",t),S.exchange&&O(S.exchange,t),B(!be(new Date,new Date(t)));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[S,O]),E=o.useCallback(pe(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.mQ)(r,f);case 2:if((t=e.sent)&&t.ticker){e.next=7;break}u("/instruments"),e.next=11;break;case 7:return C(t),e.next=10,O(t.exchange);case 10:k(!1);case 11:case"end":return e.stop()}}),e)}))),[f,u,O,r]);return o.useEffect((function(){l&&!S&&(f?E():u("/instruments"))}),[f,S,l,E,u]),o.useEffect((function(){S&&t(S.name+" (".concat(S.ticker,")"))}),[t,S]),(0,c.jsx)(ke,{setInprogress:k,inProgress:m,figi:f,instrument:S,isTradingDay:w,onCalendareChange:A,interval:h,setTickerInterval:b,selectedDate:D,setIsTradingDay:y,isBacktest:_,serverUri:r,accountId:n})}var me=function(e){var t=e.interval,r=e.onCalendareChange,n=e.setTickerInterval,a=e.selectedDate,s=o.useCallback((function(e){var t=new Date(e).getDay();return 0!==t&&6!==t}),[]);return(0,c.jsxs)("center",{children:[(0,c.jsx)(m.cw,{children:(0,c.jsx)(ue(),{dateFormat:"dd.MM.yyyy",selected:a,onChange:r,maxDate:new Date,filterDate:s,withPortal:!0})}),(0,c.jsx)(he,{interval:t,setTickerInterval:n})]})},ke=function(e){var t=e.serverUri,r=e.accountId;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(me,{interval:e.interval,setTickerInterval:e.setTickerInterval,onCalendareChange:e.onCalendareChange,selectedDate:e.selectedDate}),e.inProgress?(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("center",{children:[(0,c.jsx)("br",{}),(0,c.jsx)(m.$j,{color:"primary",children:"Loading..."})]})}):"",e.isTradingDay?e.isBacktest?(0,c.jsx)(se,{interval:e.interval,setInprogress:e.setInprogress,inProgress:e.inProgress,selectedDate:e.selectedDate,figi:e.figi,instrument:e.instrument,setIsTradingDay:e.setIsTradingDay,serverUri:t}):(0,c.jsx)(Z,{interval:e.interval,setInprogress:e.setInprogress,inProgress:e.inProgress,selectedDate:e.selectedDate,figi:e.figi,instrument:e.instrument,setIsTradingDay:e.setIsTradingDay,serverUri:t,accountId:r}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),(0,c.jsx)("center",{children:"\u0411\u0438\u0440\u0436\u0430 \u0437\u0430\u043a\u0440\u044b\u0442\u0430."})]})]})}},7982:function(e,t,r){"use strict";r.d(t,{C$:function(){return d},SK:function(){return i},mQ:function(){return u},nx:function(){return f},wO:function(){return l},zU:function(){return p}});var n=r(4051),a=r.n(n);function c(e,t,r,n,a,c,s){try{var o=e[c](s),i=o.value}catch(u){return void r(u)}o.done?t(i):Promise.resolve(i).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function o(e){c(s,n,a,o,i,"next",e)}function i(e){c(s,n,a,o,i,"throw",e)}o(void 0)}))}}var o={cache:"no-cache","Content-Type":"application/json"},i=function(){var e=s(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch("".concat(t,"/").concat(r),o);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=14;break}return e.next=13,n.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),u=function(){var e=s(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch("".concat(t,"/figi/").concat(r),o);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=14;break}return e.next=13,n.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),l=function(){var e=s(a().mark((function e(t,r,n,c,s){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s||(s=new Date(c),c.setHours(5,0,0,0),s.setHours(20,59,59,999)),e.prev=2,e.next=5,window.fetch("".concat(t,"/getcandles/").concat(r,"?interval=").concat(n,"&from=").concat(c.getTime(),"&to=").concat(s.getTime()),o);case 5:i=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",!1);case 11:if(!i||!i.ok){e.next=15;break}return e.next=14,i.json();case 14:return e.abrupt("return",e.sent);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r,n,a,c){return e.apply(this,arguments)}}(),f=function(){var e=s(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,window.fetch("".concat(t,"/getlastpriceandorderbook/").concat(r),o);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=14;break}return e.next=13,n.json();case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}(),p=function(){var e=s(a().mark((function e(t,r,n){var c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(t,"/getcachedorderbook/").concat(r)+(n?"?time=".concat(n):""),e.prev=2,e.next=5,window.fetch(t,o);case 5:c=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",!1);case 11:if(!c||!c.ok){e.next=15;break}return e.next=14,c.json();case 14:return e.abrupt("return",e.sent);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r,n){return e.apply(this,arguments)}}(),d=function(){var e=s(a().mark((function e(t,r,n,c){var s,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="exchange=".concat(r,"&from=").concat(n.getTime()),i+="&to=".concat(c?c.getTime():n.getTime()+1),e.prev=3,e.next=6,window.fetch("".concat(t,"/tradingschedules?").concat(i),o);case 6:s=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",!1);case 12:if(!s||!s.ok){e.next=16;break}return e.next=15,s.json();case 15:return e.abrupt("return",e.sent);case 16:return e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,r,n,a){return e.apply(this,arguments)}}()},9249:function(e){e.exports={Backtest:"Backtest_Backtest__Vmv5T",BacktestButtons:"Backtest_BacktestButtons__Lt1jk",Arrow:"Backtest_Arrow__R0PtE",BuyArrow:"Backtest_BuyArrow__3R7oe",SellArrow:"Backtest_SellArrow__NYtBP"}},858:function(e){e.exports={RobotsSelect:"Robots_RobotsSelect__QERlu"}},9475:function(e){e.exports={TerminalColChart:"Terminal_TerminalColChart__SrbMF",TerminalColOrderBook:"Terminal_TerminalColOrderBook__IkaT6",OrderBook:"Terminal_OrderBook__xcjnB",OrderBook_hidden:"Terminal_OrderBook_hidden__95hr_",OrderBookHide:"Terminal_OrderBookHide__hKeir"}}},function(e){e.O(0,[520,898,581,774,888,179],(function(){return t=4009,e(e.s=t);var t}));var t=e.O();_N_E=t}]);